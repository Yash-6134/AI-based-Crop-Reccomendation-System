{% extends 'base_modern.html' %}

{% block title %}{{ _('Crop Recommendation Results - KRUSHIMITRA') }}{% endblock %}

{% block extra_css %}
<style>
    /* Result Hero Section */
    .result-hero {
        padding: 6rem 2rem 4rem;
        text-align: center;
        position: relative;
    }

    .result-hero h1 {
        font-size: 3rem;
        font-weight: 900;
        color: white;
        margin-bottom: 1rem;
        font-family: 'Space Grotesk', sans-serif;
    }

    .success-icon {
        width: 100px;
        height: 100px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        animation: successPulse 2s infinite;
    }

    @keyframes successPulse {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
            transform: scale(1);
        }
        50% {
            box-shadow: 0 0 0 20px rgba(255, 255, 255, 0);
            transform: scale(1.05);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            transform: scale(1);
        }
    }

    .success-icon i {
        font-size: 3rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* Main Result Card */
    .result-container {
        max-width: 1200px;
        margin: -2rem auto 4rem;
        padding: 0 2rem;
        position: relative;
    }

    .main-result-card {
        background: white;
        border-radius: 30px;
        overflow: hidden;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        animation: slideUp 0.8s ease-out;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .result-header {
        background: var(--primary-gradient);
        padding: 3rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .result-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 15s linear infinite;
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .crop-name {
        font-size: 3.5rem;
        font-weight: 900;
        color: white;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        animation: fadeInScale 1s ease-out;
    }

    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.5);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .confidence-badge {
        display: inline-block;
        background: white;
        color: var(--primary);
        padding: 1rem 2rem;
        border-radius: 50px;
        font-weight: 700;
        font-size: 1.2rem;
        animation: bounceIn 1.2s ease-out;
    }

    @keyframes bounceIn {
        0% {
            opacity: 0;
            transform: scale(0.3);
        }
        50% {
            transform: scale(1.05);
        }
        70% {
            transform: scale(0.9);
        }
        100% {
            opacity: 1;
            transform: scale(1);
        }
    }

    .crop-image-container {
        padding: 3rem;
        text-align: center;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }

    .crop-image {
        width: 250px;
        height: 250px;
        border-radius: 20px;
        object-fit: cover;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }

    /* Info Cards */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        padding: 3rem;
    }

    .info-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
        border-radius: 20px;
        padding: 2rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 1px solid #e2e8f0;
    }

    .info-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--primary-gradient);
    }

    .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .info-card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .info-icon {
        width: 50px;
        height: 50px;
        background: var(--primary-gradient);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .info-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-dark);
    }

    .info-content {
        color: var(--text-light);
        line-height: 1.8;
    }

    /* ROI Section */
    .roi-section {
        padding: 3rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .roi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

    .roi-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .roi-card:hover {
        transform: translateY(-10px) scale(1.05);
        background: rgba(255, 255, 255, 0.2);
    }

    .roi-value {
        font-size: 2.5rem;
        font-weight: 900;
        color: white;
        margin-bottom: 0.5rem;
    }

    .roi-label {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* Parameters Display */
    .parameters-section {
        padding: 3rem;
        background: #f7fafc;
    }

    .parameters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
    }

    .parameter-item {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .parameter-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--primary-gradient);
    }

    .parameter-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .parameter-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
    }

    .parameter-name {
        font-size: 0.9rem;
        color: var(--text-light);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .parameter-value {
        font-size: 1.5rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* Tips Section */
    .tips-section {
        padding: 3rem;
        background: white;
    }

    .tips-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
        border-radius: 15px;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        animation: slideInLeft 0.8s ease-out;
    }

    .tip-item:hover {
        transform: translateX(10px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .tip-icon {
        width: 40px;
        height: 40px;
        background: var(--primary-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .tip-text {
        color: var(--text-light);
        line-height: 1.6;
    }

    /* Action Buttons */
    .action-buttons {
        padding: 3rem;
        text-align: center;
        background: #f7fafc;
    }

    .action-buttons .btn {
        margin: 0.5rem;
        padding: 1rem 2.5rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: white;
        color: var(--primary);
        border: 2px solid var(--primary);
    }

    .btn-secondary:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-5px);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .crop-name {
            font-size: 2rem;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }

        .parameters-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Loading Animation for Images */
    .image-loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Result Hero -->
<section class="result-hero">
    <div class="success-icon" data-aos="zoom-in">
        <i class="fas fa-check"></i>
    </div>
    <h1 data-aos="fade-up" data-aos-delay="200">{{ _('Your Crop Recommendation is Ready!') }}</h1>
</section>

<!-- Main Result Card -->
<div class="result-container">
    <div class="main-result-card">
        <!-- Result Header -->
        <div class="result-header">
            <div class="crop-name">{{ result.crop }}</div>
            <div class="confidence-badge">
                <i class="fas fa-chart-line"></i> {{ result.confidence }}% {{ _('Confidence') }}
            </div>
        </div>

        <!-- Crop Image -->
        <div class="crop-image-container">
            <img src="{{ url_for('static', filename='img/' + result.image) }}" 
                 alt="{{ result.crop }}" 
                 class="crop-image"
                 onerror="this.src='https://via.placeholder.com/250x250?text={{ result.crop }}'"
                 data-aos="zoom-in">
        </div>

        <!-- Info Cards -->
        <div class="info-grid">
            <!-- Description Card -->
            <div class="info-card" data-aos="fade-right">
                <div class="info-card-header">
                    <div class="info-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="info-title">{{ _('About This Crop') }}</div>
                </div>
                <div class="info-content">
                    {{ result.description }}
                </div>
            </div>

            <!-- Ideal Conditions Card -->
            <div class="info-card" data-aos="fade-left">
                <div class="info-card-header">
                    <div class="info-icon">
                        <i class="fas fa-thermometer-half"></i>
                    </div>
                    <div class="info-title">{{ _('Ideal Conditions') }}</div>
                </div>
                <div class="info-content">
                    {{ result.ideal_conditions }}
                </div>
            </div>
        </div>

        <!-- ROI Section -->
        {% if roi %}
        <div class="roi-section">
            <h2 style="text-align: center; color: white; margin-bottom: 2rem; font-size: 2rem;">
                {{ _('Expected Returns') }}
            </h2>
            <div class="roi-grid">
                <div class="roi-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="roi-value">₹{{ "{:,.0f}".format(roi.gross) }}</div>
                    <div class="roi-label">{{ _('Gross Income') }}</div>
                </div>
                <div class="roi-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="roi-value">₹{{ "{:,.0f}".format(roi.net) }}</div>
                    <div class="roi-label">{{ _('Net Profit') }}</div>
                </div>
                {% if is_msp %}
                <div class="roi-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="roi-value">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="roi-label">{{ _('MSP Protected') }}</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Parameters Section -->
        <div class="parameters-section">
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--text-dark); font-size: 2rem;">
                {{ _('Your Input Parameters') }}
            </h2>
            <div class="parameters-grid">
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="100">
                    <div class="parameter-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="parameter-name">{{ _('Nitrogen') }}</div>
                    <div class="parameter-value">{{ input_data.nitrogen }}</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="150">
                    <div class="parameter-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <div class="parameter-name">{{ _('Phosphorus') }}</div>
                    <div class="parameter-value">{{ input_data.phosphorus }}</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="200">
                    <div class="parameter-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="parameter-name">{{ _('Potassium') }}</div>
                    <div class="parameter-value">{{ input_data.potassium }}</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="250">
                    <div class="parameter-icon">
                        <i class="fas fa-temperature-high"></i>
                    </div>
                    <div class="parameter-name">{{ _('Temperature') }}</div>
                    <div class="parameter-value">{{ input_data.temperature }}°C</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="300">
                    <div class="parameter-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="parameter-name">{{ _('Humidity') }}</div>
                    <div class="parameter-value">{{ input_data.humidity }}%</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="350">
                    <div class="parameter-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                    <div class="parameter-name">{{ _('pH') }}</div>
                    <div class="parameter-value">{{ input_data.ph }}</div>
                </div>
                <div class="parameter-item" data-aos="zoom-in" data-aos-delay="400">
                    <div class="parameter-icon">
                        <i class="fas fa-cloud-rain"></i>
                    </div>
                    <div class="parameter-name">{{ _('Rainfall') }}</div>
                    <div class="parameter-value">{{ input_data.rainfall }}mm</div>
                </div>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="tips-section">
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--text-dark); font-size: 2rem;">
                <i class="fas fa-lightbulb" style="color: #f7b731;"></i> {{ _('Smart Farming Tips') }}
            </h2>
            <div class="tips-container">
                <div class="tip-item" data-aos="fade-up">
                    <div class="tip-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="tip-text">
                        {{ _('Prepare your soil properly before planting for optimal crop growth') }}
                    </div>
                </div>
                <div class="tip-item" data-aos="fade-up" data-aos-delay="100">
                    <div class="tip-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <div class="tip-text">
                        {{ _('Implement efficient irrigation methods to conserve water and reduce costs') }}
                    </div>
                </div>
                <div class="tip-item" data-aos="fade-up" data-aos-delay="200">
                    <div class="tip-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="tip-text">
                        {{ _('Monitor market prices regularly to maximize your profits') }}
                    </div>
                </div>
                <div class="tip-item" data-aos="fade-up" data-aos-delay="300">
                    <div class="tip-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="tip-text">
                        {{ _('Use organic pest control methods when possible for sustainable farming') }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="/" class="btn btn-primary">
                <i class="fas fa-redo"></i> {{ _('New Prediction') }}
            </a>
            <a href="/data-insights" class="btn btn-secondary">
                <i class="fas fa-chart-bar"></i> {{ _('View Insights') }}
            </a>
            <button onclick="window.print()" class="btn btn-secondary">
                <i class="fas fa-print"></i> {{ _('Print Results') }}
            </button>
        </div>
    </div>
</div>

<!-- Success Confetti Animation -->
<canvas id="confetti"></canvas>
<style>
    #confetti {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
    // Confetti animation on load
    window.addEventListener('load', () => {
        const duration = 3000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();

            if (timeLeft <= 0) {
                return clearInterval(interval);
            }

            const particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, {
                particleCount,
                origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
            }));
            confetti(Object.assign({}, defaults, {
                particleCount,
                origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
            }));
        }, 250);
    });

    // Smooth scroll reveal for elements
    const revealElements = document.querySelectorAll('[data-aos]');
    
    const revealOnScroll = () => {
        revealElements.forEach(element => {
            const elementTop = element.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            
            if (elementTop < windowHeight - 100) {
                element.classList.add('revealed');
            }
        });
    };

    window.addEventListener('scroll', revealOnScroll);
    revealOnScroll();

    // Print styles
    const style = document.createElement('style');
    style.textContent = `
        @media print {
            .navbar-modern, .action-buttons, #confetti {
                display: none !important;
            }
            .main-content {
                padding-top: 0 !important;
            }
            .result-container {
                margin-top: 0 !important;
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}
